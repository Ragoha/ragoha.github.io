---
layout: single
title: "Spring Security 로그인&회원가입"
categories: SpringBoot
tag: [SpringBoot, SpringSecurity, Login]
toc: true
toc_sticky: true
toc_label: "Spring Security <br>&nbsp;&nbsp;&nbsp;로그인&회원가입"
author_profile: false
sidebar:
  nav: "docs"
---

## 1.프로젝트 생성

![image-20230202143305341](/images/2023-02-02-third/image-20230202143305341.png){: .align-center}

[**https://start.spring.io/**](https://start.spring.io/) 를 통해 프로젝트 생성 및 **Dependencies**를 추가한다.



## 2.application.yml 설정

```xml
server:
  port: 8080
  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true

spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/DB스키마명?serverTimezone=Asia/Seoul
    username: /*DB아이디*/
    password: /*DB패스워드 */

  mvc:
    view:
      prefix: /templates/
      suffix: .html

  jpa:
    hibernate:
      ddl-auto: update #create update none
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
    show-sql: true

```

**JPA**를 추가하고 **Datasource** 설정하지 않으면 **Tomcat** 실행 시 아래의 오류가 발생한다. ~~(Datasource 설정하라는)~~

Failed to configure a DataSource: 'url' attribute is not specified and no embedded datasource could be configured.<br>
Reason: Failed to determine a suitable driver class <br>
Action: Consider the following: If you want an embedded database (H2, HSQL or Derby), please put it on the classpath. <br>
If you have database settings to be loaded from a particular profile you may need to activate it (no profiles are currently active).

기존 **application.properties** -> **application.yml**로 변경 후 **Server, Datasource, View, JPA** 설정한다.



## 3.Tomcat 서버 실행

![image-20230202145321262](/images/2023-02-02-third/image-20230202145321262.png){: .align-center}

**application.yml** 설정 후 서버를 실행한 뒤에
**http://localhost:8080/** 로 접속해면 **/login**으로 이동하면서 **Spring Security**에서 기본적으로 제공해주는 화면이 나타난다.
**Username**는  user, **Password**는 서버 실행 시 아래와 같이 알려준다.
![image-20230202151144942](/images/2023-02-02-third/image-20230202151144942.png)



## 4.HomeController & Index 설정

### HomeController.java

```java
@Controller
public class HomeController {
    @GetMapping({"","/"})
    public String Home(){
        return "index";
    }
}
```

### Index.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index 페이지</title>
</head>
<body>
    Index 페이지 입니다.
</body>
</html>
```

<img src="/images/2023-02-02-third/image-20230202152109397.png" alt="image-20230202152109397" style="border: 1px solid black; zoom: 150%;" />{: .align-center}

모든 경로를 Spring Security가 통제하기 떄문에 로그인을 해야 원래 이동하려 했던 경로로 자동이동이 된다.
로그인 후 **/** 로 이동하면 **Index** 페이지 확인이 가능해진다.



## 5.SecurityFilterChain 설정

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http.csrf().disable();
        http.authorizeRequests()
            .antMatchers("/user/**").authenticated()
            .antMatchers("/manager/**").access("hasRole('ROLE_MANAGER') or hasRole('ROLE_ADMIN') ")
            .antMatchers("/admin/**").access("hasRole('ROLE_ADMIN')")
            .anyRequest().permitAll();
        http.formLogin()
            .loginPage("/login")
            .loginProcessingUrl("/loginProc")
            .defaultSuccessUrl("/");

        return http.build();
    }
    
}
```



Spring Security 5.7.0-M2 부터 컴포넌트 기반의 보안 설정을 권장한다는 이유로 **WebSecurityConfigurerAdapter** 가 **Deprecated** 처리되고 **SecurityFilterChain**을 사용하는걸 권장한다.

​	**.csrf().disable()** -> **Cross Site Request Forgery**(사이트 간 요청 위조) **Protection** 기능을 **disalbe** 설정

​	**.authorizeRequests()** -> 메소드로 특정한 경로에 특정한 권한을 가진 사용자만 접근할 수 있도록 설정

​	**.antMatchers("") .authenticated()** -> 특정 경로에 대해서 권한 설정 및 인증된 사용자면 접근 가능 

​	**.antMatchers("") .access()** ->  특정 경로에 대해서 권한 설정

​	**.anyRequest().permitAll()** -> 특정 경로 외 나머지 경로들의 접근을 인증절차 없이 허용

​	**.formLogin()** -> 로그인 페이지와 기타 로그인 처리 및 성공 실패 처리를 사용

​	**.loginPage("")** -> 특정 경로로 로그인 페이지 설정

​	**.loginProcessingUrl("")** -> 로그인 인증 처리하는 URL 설정, 특정 경로가 호출되면 인증처리 수행하는 필터가 호출

​	**.defaultSuccessUrl("")** -> 로그인 성공시 특정 경로로 페이지 이동

참조 [https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html](https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html)
